<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Word Adventure â€” reading.games</title>
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --black:#000000;
  --gray-1:#0D0D0D;
  --gray-2:#1A1A1A;
  --gray-3:#262626;
  --gray-4:#333333;
  --gray-text:#888888;
  --teal:#00FFF2;
  --teal-dim:rgba(0,255,242,.12);
  --teal-glow:rgba(0,255,242,.2);
  --red:#FF4757;
  --green:#2ED573;
}

body{
  font-family:'Inter',system-ui,-apple-system,sans-serif;
  min-height:100vh;
  overflow-x:hidden;
  background:var(--black);
  color:#fff;
  -webkit-user-select:none;
  user-select:none;
  position:relative;
}

/* Grid overlay */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background-image:
    linear-gradient(rgba(255,255,255,.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.02) 1px, transparent 1px);
  background-size:60px 60px;
  pointer-events:none;
  z-index:0;
}

/* Ambient orbs */
.orb{position:fixed;border-radius:50%;filter:blur(120px);pointer-events:none;z-index:0}
.orb-1{width:400px;height:400px;background:rgba(0,255,242,.06);top:-120px;left:-120px}
.orb-2{width:350px;height:350px;background:rgba(0,255,242,.04);bottom:-100px;right:-100px}
.orb-3{width:200px;height:200px;background:rgba(0,255,242,.03);top:40%;left:70%}

#app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:20px;
  position:relative;
  z-index:1;
}

/* ===== WELCOME SCREEN ===== */
.welcome{text-align:center;animation:fadeIn .5s ease;max-width:420px;width:100%}
.welcome h1{font-size:2.8rem;font-weight:900;letter-spacing:-0.03em;margin-bottom:4px}
.welcome h1 span{color:var(--teal)}
.welcome .mascot{font-size:4rem;display:block;margin:10px auto;animation:float 3s ease-in-out infinite}
.welcome .subtitle{font-size:1.05rem;color:var(--gray-text);margin-bottom:30px;font-weight:400}

.grade-grid{display:flex;flex-direction:column;gap:10px;width:100%}
.grade-btn{
  padding:16px 24px;
  border:1px solid var(--gray-3);
  border-radius:14px;
  font-size:1.2rem;
  font-family:inherit;
  cursor:pointer;
  color:#000;
  font-weight:700;
  letter-spacing:-0.01em;
  background:var(--teal);
  transition:transform .12s,box-shadow .2s,background .2s;
  box-shadow:0 0 0 rgba(0,255,242,0);
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.grade-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 0 25px rgba(0,255,242,.25),0 8px 25px rgba(0,0,0,.3);
}
.grade-btn:active{transform:translateY(1px);box-shadow:none}
.word-count{font-size:.8rem;font-weight:500;opacity:.6}

/* ===== SETTINGS ===== */
.settings-btn{
  position:absolute;top:15px;right:15px;
  background:var(--gray-2);border:1px solid var(--gray-3);
  border-radius:10px;width:42px;height:42px;font-size:1.2rem;
  cursor:pointer;transition:transform .15s,border-color .2s;color:var(--gray-text);
}
.settings-btn:hover{border-color:var(--teal);transform:rotate(30deg);color:var(--teal)}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease;backdrop-filter:blur(4px)}
.modal{background:var(--gray-1);border:1px solid var(--gray-3);border-radius:18px;padding:28px;max-width:420px;width:100%;box-shadow:0 25px 60px rgba(0,0,0,.6)}
.modal h3{font-size:1.3rem;font-weight:800;margin-bottom:16px;text-align:center;letter-spacing:-0.02em}
.modal label{display:block;font-size:.9rem;margin-bottom:6px;color:var(--gray-text);font-weight:500}
.modal input{
  width:100%;padding:12px 14px;
  border:1px solid var(--gray-3);border-radius:10px;
  background:var(--gray-2);color:#fff;
  font-size:.95rem;font-family:inherit;outline:none;
  transition:border-color .2s;
}
.modal input:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(0,255,242,.1)}
.modal .hint{font-size:.78rem;color:var(--gray-text);margin-top:8px;line-height:1.5}
.modal .hint strong{color:#ccc}
.modal .api-status{margin-top:12px;padding:10px 12px;border-radius:10px;font-size:.85rem;text-align:center;font-weight:500}
.modal .api-status.connected{background:rgba(46,213,115,.1);color:var(--green);border:1px solid rgba(46,213,115,.2)}
.modal .api-status.none{background:var(--teal-dim);color:var(--teal);border:1px solid rgba(0,255,242,.15)}
.modal-buttons{display:flex;gap:10px;margin-top:20px}
.modal-buttons button{
  flex:1;padding:12px;border:none;border-radius:10px;
  font-size:1rem;font-family:inherit;font-weight:700;
  cursor:pointer;transition:transform .1s;
}
.modal-buttons button:active{transform:scale(.97)}
.btn-save{background:var(--teal);color:#000}
.btn-cancel{background:var(--gray-3);color:var(--gray-text)}

/* ===== QUIZ SCREEN ===== */
.quiz{width:100%;max-width:480px;animation:fadeIn .3s ease}
.quiz-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:0 2px}
.score-display{font-size:1.15rem;font-weight:700}
.score-display .pts{color:var(--teal)}
.progress-display{font-size:1rem;color:var(--gray-text);font-weight:500}

.progress-bar{width:100%;height:6px;background:var(--gray-3);border-radius:6px;margin-bottom:24px;overflow:hidden}
.progress-fill{height:100%;border-radius:6px;transition:width .4s ease;background:var(--teal);box-shadow:0 0 10px rgba(0,255,242,.3)}

.emoji-area{text-align:center;margin-bottom:8px}
.emoji-big{font-size:5.5rem;display:block;animation:popIn .4s ease}
.speaker-btn{
  background:var(--gray-2);border:1px solid var(--gray-3);
  border-radius:10px;width:48px;height:48px;font-size:1.3rem;
  cursor:pointer;margin:10px auto;display:block;
  transition:transform .15s,border-color .2s,box-shadow .2s;color:var(--gray-text);
}
.speaker-btn:hover{border-color:var(--teal);color:var(--teal);box-shadow:0 0 15px rgba(0,255,242,.15);transform:scale(1.05)}

.options-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.option-btn{
  padding:20px 14px;
  border:1px solid var(--gray-3);
  border-radius:14px;
  font-size:1.6rem;
  font-family:inherit;
  cursor:pointer;
  background:var(--gray-2);
  color:#fff;
  font-weight:700;
  letter-spacing:-0.01em;
  transition:transform .1s,border-color .15s,box-shadow .2s,background .15s;
  text-align:center;
  min-height:68px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.option-btn:hover{
  border-color:rgba(0,255,242,.4);
  box-shadow:0 0 20px rgba(0,255,242,.08);
  transform:scale(1.02);
}
.option-btn:active{transform:scale(.97)}
.option-btn.correct{
  background:rgba(46,213,115,.15)!important;
  border-color:var(--green)!important;
  box-shadow:0 0 25px rgba(46,213,115,.2)!important;
  color:var(--green)!important;
  animation:correctPulse .5s ease;
}
.option-btn.wrong{
  background:rgba(255,71,87,.1)!important;
  border-color:var(--red)!important;
  box-shadow:0 0 20px rgba(255,71,87,.15)!important;
  color:var(--red)!important;
  animation:wrongShake .4s ease;
}
.option-btn.disabled{pointer-events:none;opacity:.5}

.feedback{text-align:center;margin-top:16px;font-size:1.2rem;font-weight:700;min-height:40px;display:flex;align-items:center;justify-content:center;letter-spacing:-0.01em}
.feedback.correct-fb{color:var(--green);animation:fadeIn .3s}
.feedback.wrong-fb{color:var(--red);animation:fadeIn .3s}

/* ===== RESULTS SCREEN ===== */
.results{text-align:center;width:100%;max-width:480px;animation:fadeIn .5s ease}
.results h2{font-size:2.2rem;font-weight:900;margin-bottom:4px;letter-spacing:-0.03em}
.results h2 span{color:var(--teal)}
.stars-area{font-size:3.5rem;margin:8px 0}
.score-final{font-size:1.2rem;margin-bottom:24px;color:var(--gray-text);font-weight:500}
.score-final strong{color:#fff}
.review-section{text-align:left;margin:20px 0}
.review-section h3{font-size:1.1rem;font-weight:700;margin-bottom:12px;text-align:center;color:var(--gray-text)}
.review-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.review-card{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;
  background:var(--gray-2);
  border-radius:10px;
  border-left:3px solid var(--green);
}
.review-card.missed{border-left-color:var(--red)}
.review-card .r-emoji{font-size:1.6rem}
.review-card .r-word{font-size:1.05rem;font-weight:600}
.review-card .r-check{margin-left:auto;font-size:1rem}

.results-buttons{display:flex;gap:10px;justify-content:center;margin-top:24px;flex-wrap:wrap}
.results-buttons button{
  padding:14px 28px;border:none;border-radius:12px;
  font-size:1.05rem;font-family:inherit;font-weight:700;
  cursor:pointer;transition:transform .1s,box-shadow .2s;
}
.results-buttons button:active{transform:translateY(2px)}
.btn-replay{background:var(--teal);color:#000;box-shadow:0 0 20px rgba(0,255,242,.15)}
.btn-replay:hover{box-shadow:0 0 30px rgba(0,255,242,.25)}
.btn-home{background:var(--gray-3);color:var(--gray-text)}
.btn-home:hover{color:#fff}

.back-link{
  display:inline-flex;align-items:center;gap:6px;
  margin-top:20px;font-size:.85rem;color:var(--gray-text);
  text-decoration:none;font-weight:500;
  transition:color .2s;
}
.back-link:hover{color:var(--teal)}

/* ===== CONFETTI CANVAS ===== */
#confetti-canvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes popIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}100%{transform:scale(1);opacity:1}}
@keyframes correctPulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
@keyframes starPop{0%{transform:scale(0) rotate(0deg);opacity:0}60%{transform:scale(1.3) rotate(10deg);opacity:1}100%{transform:scale(1) rotate(0deg);opacity:1}}
.star-anim{display:inline-block;animation:starPop .5s ease forwards;opacity:0}
.star-anim:nth-child(1){animation-delay:.1s}
.star-anim:nth-child(2){animation-delay:.3s}
.star-anim:nth-child(3){animation-delay:.5s}

/* ===== RESPONSIVE ===== */
@media(max-width:500px){
  .welcome h1{font-size:2.2rem}
  .emoji-big{font-size:4rem}
  .option-btn{font-size:1.3rem;padding:16px 10px}
}
@media(min-width:768px){
  .options-grid{max-width:440px;margin-left:auto;margin-right:auto}
}
</style>
</head>
<body>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>
<div id="app"></div>
<canvas id="confetti-canvas"></canvas>

<script>
// ===================== WORD DATA =====================
const GRADES = {
  kindergarten: {
    name: "Kindergarten",
    words: [
      ["a","ðŸ…°ï¸"],["about","ðŸ’­"],["all","ðŸŒŽ"],["am","ðŸ™‹"],["an","ðŸ“"],
      ["and","ðŸ¤"],["apple","ðŸŽ"],["are","ðŸ‘¥"],["as","âž¡ï¸"],["at","ðŸ“"],
      ["baby","ðŸ‘¶"],["be","ðŸ"],["bed","ðŸ›ï¸"],["been","âœ…"],["bell","ðŸ””"],
      ["but","âœ‹"],["by","ðŸ‘‹"],["bye","ðŸ‘‹"],["called","ðŸ“ž"],["can","ðŸ’ª"],
      ["cat","ðŸ±"],["come","ðŸ«³"],["could","ðŸ¤”"],["day","â˜€ï¸"],["did","âœ…"],
      ["do","ðŸ’ª"],["doll","ðŸ§¸"],["down","â¬‡ï¸"],["drink","ðŸ¥¤"],["duck","ðŸ¦†"],
      ["each","â˜ï¸"],["egg","ðŸ¥š"],["find","ðŸ”"],["first","ðŸ¥‡"],["for","ðŸŽ"],
      ["from","ðŸ“¤"],["get","ðŸŽ¯"],["go","ðŸƒ"],["going","ðŸš¶"],["had","ðŸ“¦"],
      ["has","ðŸŽ’"],["have","ðŸ¤²"],["he","ðŸ‘¦"],["her","ðŸ‘§"],["hill","â›°ï¸"],
      ["him","ðŸ‘¦"],["his","ðŸ‘¤"],["how","â“"],["I","ðŸ™‹"],["if","ðŸ¤·"],
      ["in","ðŸ“¥"],["into","ðŸ“¥"],["is","âœ¨"],["it","ðŸ‘‰"],["its","ðŸ·ï¸"],
      ["jump","ðŸ¦˜"],["leg","ðŸ¦µ"],["like","â¤ï¸"],["long","ðŸ“"],["look","ðŸ‘€"],
      ["made","ðŸ—ï¸"],["make","ðŸ”¨"],["many","ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦"],["may","ðŸŒ¸"],["more","âž•"],
      ["my","ðŸ’"],["no","ðŸš«"],["not","âŒ"],["now","â°"],["number","ðŸ”¢"],
      ["of","ðŸ“Ž"],["on","ðŸ”›"],["one","1ï¸âƒ£"],["or","â†”ï¸"],["other","ðŸ‘‰"],
      ["out","ðŸšª"],["part","ðŸ§©"],["people","ðŸ‘¥"],["pick","âœ‹"],["pig","ðŸ·"],
      ["ring","ðŸ’"],["said","ðŸ’¬"],["see","ðŸ‘ï¸"],["she","ðŸ‘©"],["sit","ðŸª‘"],
      ["sleep","ðŸ˜´"],["so","ðŸ’«"],["some","ðŸ”µ"],["than","âš–ï¸"],["that","ðŸ‘†"],
      ["the","ðŸ“Œ"],["their","ðŸ‘¨â€ðŸ‘©â€ðŸ‘§"],["them","ðŸ‘«"],["then","â­ï¸"],["there","ðŸ“"],
      ["these","ðŸ‘‡"],["they","ðŸ‘¥"],["this","ðŸ‘ˆ"],["time","â°"],["to","âž¡ï¸"],
      ["two","âœŒï¸"],["up","â¬†ï¸"],["use","ðŸ”§"],["was","ðŸ“…"],["water","ðŸ’§"],
      ["way","ðŸ›¤ï¸"],["we","ðŸ‘«"],["were","ðŸ“…"],["what","â“"],["when","ðŸ•"],
      ["which","ðŸ¤”"],["who","ðŸ•µï¸"],["will","ðŸ’ª"],["with","ðŸ¤"],["words","ðŸ“–"],
      ["would","ðŸ’­"],["write","âœï¸"],["yellow","ðŸ’›"],["you","ðŸ«µ"],["your","ðŸŽ’"]
    ]
  },
  grade1: {
    name: "Grade 1",
    words: [
      ["after","â°"],["again","ðŸ”„"],["air","ðŸ’¨"],["also","âž•"],["animal","ðŸ¾"],
      ["another","ðŸ”"],["answer","ðŸ’¡"],["any","ðŸŒŸ"],["around","ðŸ”„"],["ask","â“"],
      ["away","ðŸƒ"],["back","ðŸ”™"],["bear","ðŸ»"],["because","ðŸ’¡"],["before","âª"],
      ["big","ðŸ˜"],["bird","ðŸ¦"],["blue","ðŸ’™"],["boy","ðŸ‘¦"],["brown","ðŸŸ¤"],
      ["cake","ðŸŽ‚"],["came","ðŸš¶"],["car","ðŸš—"],["change","ðŸ”„"],["coat","ðŸ§¥"],
      ["corn","ðŸŒ½"],["cow","ðŸ„"],["different","ðŸ”€"],["does","ðŸ¤·"],["don't","ðŸš«"],
      ["end","ðŸ"],["even","âš–ï¸"],["flower","ðŸŒ¸"],["follow","ðŸ‘£"],["form","ðŸ“‹"],
      ["found","ðŸ”"],["girl","ðŸ‘§"],["give","ðŸŽ"],["goes","ðŸš¶"],["gone","ðŸ’¨"],
      ["good","ðŸ‘"],["grass","ðŸŒ±"],["great","â­"],["hand","âœ‹"],["happy","ðŸ˜Š"],
      ["help","ðŸ†˜"],["here","ðŸ“"],["home","ðŸ "],["house","ðŸ¡"],["just","â˜ï¸"],
      ["kind","ðŸ’"],["know","ðŸ§ "],["land","ðŸï¸"],["large","ðŸ‹"],["learn","ðŸ“š"],
      ["letter","âœ‰ï¸"],["line","âž–"],["little","ðŸœ"],["live","ðŸ "],["man","ðŸ‘¨"],
      ["me","ðŸ™‹"],["means","ðŸ’­"],["men","ðŸ‘¨â€ðŸ‘¨â€ðŸ‘¦"],["moon","ðŸŒ™"],["most","ðŸ†"],
      ["move","ðŸƒ"],["much","ðŸŒŠ"],["must","âš¡"],["name","ðŸ“›"],["need","ðŸ™"],
      ["nest","ðŸªº"],["new","âœ¨"],["nine","9ï¸âƒ£"],["off","ðŸ“´"],["old","ðŸ‘´"],
      ["only","â˜ï¸"],["our","ðŸ‘¨â€ðŸ‘©â€ðŸ‘§"],["over","ðŸŒˆ"],["page","ðŸ“„"],["picture","ðŸ–¼ï¸"],
      ["place","ðŸ“"],["play","âš½"],["point","ðŸ‘†"],["put","ðŸ“¥"],["read","ðŸ“–"],
      ["red","â¤ï¸"],["right","âœ…"],["run","ðŸƒ"],["same","ðŸ‘¯"],["say","ðŸ’¬"],
      ["set","ðŸ“¦"],["should","ðŸ’­"],["show","ðŸŽª"],["small","ðŸ"],["sound","ðŸ”Š"],
      ["spell","âœ¨"],["still","ðŸ§˜"],["study","ðŸ“š"],["such","ðŸ’«"],["take","ðŸ¤²"],
      ["tell","ðŸ—£ï¸"],["thank","ðŸ™"],["thin","ðŸ“"],["thing","ðŸ“¦"],["think","ðŸ¤”"],
      ["three","3ï¸âƒ£"],["through","ðŸšª"],["too","âž•"],["try","ðŸ’ª"],["turn","ðŸ”„"],
      ["us","ðŸ‘«"],["very","â­"],["want","ðŸ™"],["well","ðŸ’§"],["went","ðŸš¶"],
      ["where","ðŸ—ºï¸"],["why","â“"],["work","ðŸ’¼"],["world","ðŸŒ"],["years","ðŸ“…"]
    ]
  },
  grade2: {
    name: "Grade 2",
    words: [
      ["above","â¬†ï¸"],["add","âž•"],["almost","ðŸŽ¯"],["along","ðŸ›¤ï¸"],["always","â™¾ï¸"],
      ["ate","ðŸ½ï¸"],["began","ðŸ"],["begin","â–¶ï¸"],["being","ðŸŒŸ"],["below","â¬‡ï¸"],
      ["between","â†”ï¸"],["book","ðŸ“š"],["both","âœŒï¸"],["brother","ðŸ‘¦"],["busy","ðŸƒ"],
      ["buy","ðŸ›’"],["call","ðŸ“ž"],["carry","ðŸ‹ï¸"],["city","ðŸ™ï¸"],["clean","âœ¨"],
      ["close","ðŸšª"],["country","ðŸ¡"],["cut","âœ‚ï¸"],["dog","ðŸ¶"],["early","ðŸŒ…"],
      ["earth","ðŸŒ"],["eat","ðŸ´"],["eight","8ï¸âƒ£"],["enough","âœ‹"],["every","ðŸŒŸ"],
      ["example","ðŸ“‹"],["eyes","ðŸ‘€"],["face","ðŸ˜Š"],["family","ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦"],["far","ðŸ”­"],
      ["father","ðŸ‘¨"],["feet","ðŸ¦¶"],["few","ðŸ¤"],["food","ðŸ•"],["four","4ï¸âƒ£"],
      ["friend","ðŸ¤—"],["goodbye","ðŸ‘‹"],["got","ðŸŽ‰"],["group","ðŸ‘¥"],["grow","ðŸŒ±"],
      ["hard","ðŸ’Ž"],["head","ðŸ—£ï¸"],["hear","ðŸ‘‚"],["high","â¬†ï¸"],["idea","ðŸ’¡"],
      ["important","â­"],["it's","ðŸ‘‰"],["keep","ðŸ”’"],["kitty","ðŸ±"],["last","ðŸ"],
      ["late","â°"],["leave","ðŸšª"],["left","â¬…ï¸"],["let","ðŸ‘"],["life","ðŸŒ±"],
      ["light","ðŸ’¡"],["list","ðŸ“"],["love","â¤ï¸"],["might","ðŸ’ª"],["mile","ðŸ›¤ï¸"],
      ["milk","ðŸ¥›"],["miss","ðŸ˜¢"],["mother","ðŸ‘©"],["mountains","â›°ï¸"],["near","ðŸ“"],
      ["never","ðŸš«"],["next","â­ï¸"],["night","ðŸŒ™"],["often","ðŸ”„"],["once","â˜ï¸"],
      ["open","ðŸ“–"],["own","ðŸ "],["paper","ðŸ“„"],["plant","ðŸŒ¿"],["pull","ðŸ§²"],
      ["push","ðŸ‘"],["rain","ðŸŒ§ï¸"],["real","âœ…"],["ride","ðŸš²"],["river","ðŸžï¸"],
      ["saw","ðŸ‘ï¸"],["school","ðŸ«"],["sea","ðŸŒŠ"],["second","ðŸ¥ˆ"],["seem","ðŸ‘€"],
      ["sentence","ðŸ“"],["seven","7ï¸âƒ£"],["sheep","ðŸ‘"],["shoe","ðŸ‘Ÿ"],["side","âž¡ï¸"],
      ["sister","ðŸ‘§"],["snow","â„ï¸"],["something","ðŸ”®"],["sometimes","ðŸ•"],["song","ðŸŽµ"],
      ["soon","â°"],["start","â–¶ï¸"],["state","ðŸ›ï¸"],["stick","ðŸªµ"],["stop","ðŸ›‘"],
      ["story","ðŸ“–"],["talk","ðŸ—£ï¸"],["things","ðŸ“¦"],["those","ðŸ‘‰"],["thought","ðŸ’­"],
      ["together","ðŸ¤"],["took","ðŸ¤²"],["tree","ðŸŒ³"],["under","â¬‡ï¸"],["until","â³"],
      ["walk","ðŸš¶"],["watch","âŒš"],["while","â³"],["without","âŒ"],["young","ðŸ‘¶"]
    ]
  },
  grade3: {
    name: "Grade 3",
    words: [
      ["across","â†”ï¸"],["against","ðŸ¥Š"],["area","ðŸ“"],["beautiful","ðŸŒ¹"],["become","ðŸ¦‹"],
      ["best","ðŸ†"],["better","â¬†ï¸"],["birthday","ðŸŽ‚"],["black","â¬›"],["body","ðŸ§"],
      ["bottom","â¬‡ï¸"],["box","ðŸ“¦"],["certain","âœ…"],["children","ðŸ‘§"],["cold","ðŸ¥¶"],
      ["color","ðŸŽ¨"],["complete","âœ…"],["couple","ðŸ‘«"],["covered","ðŸ›¡ï¸"],["cried","ðŸ˜¢"],
      ["didn't","ðŸš«"],["door","ðŸšª"],["draw","âœï¸"],["during","â³"],["easy","ðŸ˜Ž"],
      ["ever","â™¾ï¸"],["fall","ðŸ‚"],["farm","ðŸšœ"],["farmer","ðŸ‘¨â€ðŸŒ¾"],["fast","âš¡"],
      ["field","ðŸŒ¾"],["figure","ðŸ§®"],["fire","ðŸ”¥"],["fish","ðŸŸ"],["five","5ï¸âƒ£"],
      ["floor","ðŸ "],["funny","ðŸ˜‚"],["garden","ðŸŒ»"],["ground","ðŸŒ"],["happened","ðŸ’¥"],
      ["heard","ðŸ‘‚"],["herself","ðŸ‘©"],["himself","ðŸ‘¨"],["hold","ðŸ¤²"],["horse","ðŸ´"],
      ["hours","â°"],["however","ðŸ¤”"],["hundred","ðŸ’¯"],["hurt","ðŸ¤•"],["I'll","ðŸ™‹"],
      ["king","ðŸ‘‘"],["knew","ðŸ§ "],["laugh","ðŸ˜‚"],["listen","ðŸ‘‚"],["low","â¬‡ï¸"],
      ["map","ðŸ—ºï¸"],["mark","âœï¸"],["measure","ðŸ“"],["money","ðŸ’°"],["morning","ðŸŒ…"],
      ["music","ðŸŽµ"],["north","ðŸ§­"],["notice","ðŸ‘€"],["order","ðŸ“‹"],["party","ðŸŽ‰"],
      ["passed","âœ…"],["pattern","ðŸ”·"],["piece","ðŸ§©"],["plan","ðŸ“‹"],["please","ðŸ™"],
      ["present","ðŸŽ"],["problem","ðŸ¤”"],["products","ðŸ“¦"],["pulled","ðŸ§²"],["purple","ðŸ’œ"],
      ["queen","ðŸ‘‘"],["questions","â“"],["rabbit","ðŸ°"],["reached","ðŸ¤²"],["remember","ðŸ§ "],
      ["rock","ðŸª¨"],["room","ðŸ "],["seed","ðŸŒ±"],["seen","ðŸ‘ï¸"],["several","ðŸ”¢"],
      ["sharp","ðŸ”ª"],["ship","ðŸš¢"],["short","ðŸ“"],["since","â°"],["sing","ðŸŽ¤"],
      ["slow","ðŸ¢"],["south","ðŸ§­"],["space","ðŸš€"],["stand","ðŸ§"],["step","ðŸ‘£"],
      ["sun","â˜€ï¸"],["sure","âœ…"],["table","ðŸª‘"],["tiny","ðŸœ"],["today","ðŸ“…"],
      ["told","ðŸ’¬"],["top","â¬†ï¸"],["toward","âž¡ï¸"],["town","ðŸ˜ï¸"],["toy","ðŸ§¸"],
      ["travel","âœˆï¸"],["true","âœ…"],["unit","ðŸ“"],["upon","â¬†ï¸"],["usually","ðŸ”„"],
      ["voice","ðŸ—£ï¸"],["vowel","ðŸ”¤"],["war","âš”ï¸"],["wash","ðŸ§¼"],["waves","ðŸŒŠ"],
      ["white","â¬œ"],["whole","â­•"],["wind","ðŸ’¨"],["window","ðŸªŸ"],["wood","ðŸªµ"]
    ]
  },
  grade4: {
    name: "Grade 4",
    words: [
      ["able","ðŸ’ª"],["ago","âª"],["allow","âœ…"],["among","ðŸ‘¥"],["appear","ðŸ‘€"],
      ["ball","âš½"],["base","ðŸ "],["became","ðŸ¦‹"],["behind","ðŸ”™"],["boat","â›µ"],
      ["bread","ðŸž"],["bring","ðŸ¤²"],["brought","ðŸ“¦"],["building","ðŸ¢"],["built","ðŸ—ï¸"],
      ["cannot","ðŸš«"],["carefully","ðŸ§"],["chair","ðŸª‘"],["check","âœ…"],["chicken","ðŸ”"],
      ["circle","â­•"],["class","ðŸ«"],["clear","ðŸ’Ž"],["climb","ðŸ§—"],["common","ðŸ¤"],
      ["contain","ðŸ“¦"],["correct","âœ…"],["course","ðŸ›¤ï¸"],["dark","ðŸŒ‘"],["decided","ðŸ¤”"],
      ["deep","ðŸŒŠ"],["done","âœ…"],["dry","ðŸœï¸"],["east","ðŸ§­"],["equation","âž•"],
      ["explain","ðŸ’¬"],["fact","ðŸ“‹"],["feel","ðŸ’"],["filled","ðŸº"],["finally","ðŸ"],
      ["fine","ðŸ‘Œ"],["fly","âœˆï¸"],["force","ðŸ’ª"],["front","â–¶ï¸"],["full","ðŸ«™"],
      ["game","ðŸŽ®"],["gave","ðŸŽ"],["government","ðŸ›ï¸"],["green","ðŸ’š"],["half","Â½"],
      ["heat","ðŸ”¥"],["heavy","ðŸ‹ï¸"],["hot","ðŸŒ¡ï¸"],["inches","ðŸ“"],["include","âž•"],
      ["inside","ðŸ“¥"],["island","ðŸï¸"],["known","ðŸ§ "],["language","ðŸ—£ï¸"],["less","âž–"],
      ["machine","âš™ï¸"],["material","ðŸ§±"],["minutes","â±ï¸"],["myself","ðŸ™‹"],["note","ðŸ“"],
      ["nothing","ðŸ•³ï¸"],["noun","ðŸ“"],["object","ðŸ“¦"],["ocean","ðŸŒŠ"],["oh","ðŸ˜®"],
      ["pair","ðŸ‘¯"],["period","â¹ï¸"],["person","ðŸ§‘"],["plane","âœˆï¸"],["power","âš¡"],
      ["pretty","ðŸŒ¸"],["produce","ðŸ¥¬"],["product","ðŸ“¦"],["quickly","âš¡"],["ran","ðŸƒ"],
      ["rest","ðŸ˜´"],["road","ðŸ›£ï¸"],["robin","ðŸ¦"],["round","â­•"],["rule","ðŸ“"],
      ["scientists","ðŸ”¬"],["shall","ðŸ‘†"],["shape","ðŸ”·"],["shown","ðŸ‘€"],["sign","ðŸª§"],
      ["six","6ï¸âƒ£"],["size","ðŸ“"],["sky","ðŸŒ¤ï¸"],["special","â­"],["squirrel","ðŸ¿ï¸"],
      ["stars","â­"],["stay","ðŸ "],["stood","ðŸ§"],["street","ðŸ›£ï¸"],["strong","ðŸ’ª"],
      ["surface","ðŸ”"],["system","âš™ï¸"],["teacher","ðŸ‘©â€ðŸ«"],["ten","ðŸ”Ÿ"],["though","ðŸ¤”"],
      ["thousand","ðŸ”¢"],["understand","ðŸ§ "],["verb","ðŸ“"],["wait","â³"],["warm","â˜€ï¸"],
      ["weak","ðŸ˜“"],["weather","ðŸŒ¤ï¸"],["week","ðŸ“…"],["wheels","ðŸ›ž"],["wish","â­"],
      ["within","ðŸ“¥"],["women","ðŸ‘©"],["year","ðŸ“…"],["yes","âœ…"],["yet","â³"]
    ]
  }
};

// ===================== GAME STATE =====================
let game = {
  screen: 'welcome',
  gradeKey: null,
  batch: [],
  questionIndex: 0,
  score: 0,
  options: [],
  answered: false,
  selectedAnswer: null,
  correctOnFirst: [],
  totalCorrectFirst: 0
};

// ===================== AUDIO =====================
let audioCtx = null;
function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playTone(freq, duration, type='sine', volume=0.15) {
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(volume, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + duration);
  } catch(e) {}
}

function playCorrectSound() {
  playTone(523, 0.12, 'sine', 0.15);
  setTimeout(() => playTone(659, 0.12, 'sine', 0.15), 100);
  setTimeout(() => playTone(784, 0.15, 'sine', 0.15), 200);
  setTimeout(() => playTone(1047, 0.3, 'sine', 0.12), 300);
}

function playWrongSound() {
  playTone(300, 0.15, 'sine', 0.1);
  setTimeout(() => playTone(250, 0.25, 'sine', 0.1), 120);
}

function playCelebration() {
  const notes = [523, 659, 784, 1047, 784, 1047, 1319];
  notes.forEach((n, i) => {
    setTimeout(() => playTone(n, 0.2, 'sine', 0.12), i * 120);
  });
}

// ElevenLabs TTS with caching + browser fallback
const audioCache = {};
const ELEVEN_VOICE_ID = '21m00Tcm4TlvDq8ikWAM';

function getElevenLabsKey() {
  return localStorage.getItem('wordadventure_11labs_key') || '';
}
function setElevenLabsKey(key) {
  localStorage.setItem('wordadventure_11labs_key', key.trim());
}

async function speak(text) {
  const apiKey = getElevenLabsKey();
  if (!apiKey) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.85;
    u.pitch = 1.1;
    u.volume = 1;
    const voices = window.speechSynthesis.getVoices();
    const preferred = voices.find(v => /samantha|karen|google.*us/i.test(v.name));
    if (preferred) u.voice = preferred;
    window.speechSynthesis.speak(u);
    return;
  }

  const cacheKey = text.toLowerCase().trim();
  if (audioCache[cacheKey]) {
    const audio = audioCache[cacheKey].cloneNode();
    audio.play().catch(() => {});
    return;
  }

  try {
    const resp = await fetch(
      `https://api.elevenlabs.io/v1/text-to-speech/${ELEVEN_VOICE_ID}`,
      {
        method: 'POST',
        headers: { 'xi-api-key': apiKey, 'Content-Type': 'application/json' },
        body: JSON.stringify({
          text: text,
          model_id: 'eleven_turbo_v2',
          voice_settings: { stability: 0.75, similarity_boost: 0.75, style: 0.4 }
        })
      }
    );
    if (!resp.ok) throw new Error('API error');
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const audio = new Audio(url);
    audioCache[cacheKey] = audio;
    audio.play().catch(() => {});
  } catch (e) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.85; u.pitch = 1.1;
    window.speechSynthesis.speak(u);
  }
}

window.speechSynthesis.getVoices();

// ===================== CONFETTI =====================
const confettiCanvas = document.getElementById('confetti-canvas');
const confettiCtx = confettiCanvas.getContext('2d');
let confettiParticles = [];
let confettiAnimId = null;

function resizeConfetti() {
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeConfetti);
resizeConfetti();

function launchConfetti(count=60) {
  const colors = ['#00FFF2','#00DDC9','#00BBAA','#ffffff','#88FFFA','#00FFF2','#33FFE8'];
  for (let i = 0; i < count; i++) {
    confettiParticles.push({
      x: Math.random() * confettiCanvas.width,
      y: -20 - Math.random() * 100,
      w: 6 + Math.random() * 7,
      h: 4 + Math.random() * 5,
      color: colors[Math.floor(Math.random() * colors.length)],
      vx: (Math.random() - 0.5) * 4,
      vy: 2 + Math.random() * 4,
      rot: Math.random() * 360,
      rotV: (Math.random() - 0.5) * 10,
      life: 1
    });
  }
  if (!confettiAnimId) animateConfetti();
}

function animateConfetti() {
  confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  confettiParticles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.1;
    p.rot += p.rotV;
    p.life -= 0.005;
    confettiCtx.save();
    confettiCtx.translate(p.x, p.y);
    confettiCtx.rotate(p.rot * Math.PI / 180);
    confettiCtx.globalAlpha = Math.max(0, p.life);
    confettiCtx.fillStyle = p.color;
    confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    confettiCtx.restore();
  });
  confettiParticles = confettiParticles.filter(p => p.life > 0 && p.y < confettiCanvas.height + 50);
  if (confettiParticles.length > 0) {
    confettiAnimId = requestAnimationFrame(animateConfetti);
  } else {
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    confettiAnimId = null;
  }
}

// ===================== GAME LOGIC =====================
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function startGame(gradeKey) {
  const gradeData = GRADES[gradeKey];
  const shuffled = shuffle(gradeData.words);
  const batch = shuffled.slice(0, 10);

  game = {
    screen: 'quiz',
    gradeKey,
    batch,
    questionIndex: 0,
    score: 0,
    options: [],
    answered: false,
    selectedAnswer: null,
    correctOnFirst: new Array(10).fill(false),
    totalCorrectFirst: 0
  };

  setupQuestion();
  render();

  setTimeout(() => {
    const [word] = game.batch[0];
    speak(word);
  }, 600);
}

function setupQuestion() {
  const gradeData = GRADES[game.gradeKey];
  const target = game.batch[game.questionIndex];
  const others = gradeData.words.filter(w => w[0] !== target[0]);
  const distractors = shuffle(others).slice(0, 3);
  game.options = shuffle([target, ...distractors]);
  game.answered = false;
  game.selectedAnswer = null;
  game.hadWrongAttempt = false;
}

function checkAnswer(idx) {
  if (game.answered) return;

  const selected = game.options[idx];
  const target = game.batch[game.questionIndex];
  const isCorrect = selected[0] === target[0];

  game.selectedAnswer = idx;

  if (isCorrect) {
    game.answered = true;
    if (!game.hadWrongAttempt) {
      game.score += 10;
      game.correctOnFirst[game.questionIndex] = true;
      game.totalCorrectFirst++;
    }
    playCorrectSound();
    launchConfetti(40);
    speak(target[0]);
    render();
    setTimeout(() => nextQuestion(), 1800);
  } else {
    game.hadWrongAttempt = true;
    playWrongSound();
    render();
    setTimeout(() => {
      game.selectedAnswer = null;
      render();
    }, 800);
  }
}

function nextQuestion() {
  game.questionIndex++;
  if (game.questionIndex >= 10) {
    game.screen = 'results';
    playCelebration();
    launchConfetti(120);
    render();
    setTimeout(() => speak(getResultsMessage()), 500);
  } else {
    setupQuestion();
    render();
    setTimeout(() => {
      const [word] = game.batch[game.questionIndex];
      speak(word);
    }, 400);
  }
}

function getResultsMessage() {
  const pct = game.totalCorrectFirst / 10;
  if (pct === 1) return "Perfect score! You are a superstar!";
  if (pct >= 0.8) return "Amazing job! You are so smart!";
  if (pct >= 0.6) return "Great work! Keep practicing!";
  return "Good try! Let's practice more!";
}

function openSettings() {
  const key = getElevenLabsKey();
  const hasKey = key.length > 0;
  const overlay = document.createElement('div');
  overlay.className = 'modal-overlay';
  overlay.innerHTML = `
    <div class="modal">
      <h3>Voice Settings</h3>
      <label for="api-key-input">ElevenLabs API Key</label>
      <input type="password" id="api-key-input" placeholder="Paste your API key here..." value="${key}" />
      <div class="hint">Get a free key at <strong>elevenlabs.io</strong> &rarr; Profile &rarr; API Keys.<br>Free tier gives ~10,000 characters/month.</div>
      <div class="api-status ${hasKey ? 'connected' : 'none'}">
        ${hasKey ? 'API key is set â€” using ElevenLabs voices' : 'No key â€” using browser voices'}
      </div>
      <div class="modal-buttons">
        <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
        <button class="btn-save" onclick="saveSettings()">Save</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  overlay.querySelector('input').focus();
}

function closeSettings() {
  const overlay = document.querySelector('.modal-overlay');
  if (overlay) overlay.remove();
}

function saveSettings() {
  const input = document.getElementById('api-key-input');
  setElevenLabsKey(input.value);
  Object.keys(audioCache).forEach(k => delete audioCache[k]);
  closeSettings();
  render();
}

function goHome() {
  game.screen = 'welcome';
  render();
}

function replayGrade() {
  startGame(game.gradeKey);
}

function speakCurrentWord() {
  if (game.screen === 'quiz' && game.questionIndex < 10) {
    const [word] = game.batch[game.questionIndex];
    speak(word);
  }
}

// ===================== RENDERING =====================
function render() {
  const app = document.getElementById('app');
  if (game.screen === 'welcome') {
    app.innerHTML = renderWelcome();
  } else if (game.screen === 'quiz') {
    app.innerHTML = renderQuiz();
  } else if (game.screen === 'results') {
    app.innerHTML = renderResults();
  }
}

function renderWelcome() {
  let gradeButtons = '';
  for (const [key, g] of Object.entries(GRADES)) {
    gradeButtons += `
      <button class="grade-btn" onclick="startGame('${key}')">
        ${g.name}
        <span class="word-count">${g.words.length} words</span>
      </button>`;
  }

  const hasKey = getElevenLabsKey().length > 0;
  return `
    <div class="welcome">
      <button class="settings-btn" onclick="openSettings()" title="Voice Settings">&#9881;</button>
      <span class="mascot">ðŸ¦‰</span>
      <h1>Word <span>Adventure</span></h1>
      <p class="subtitle">Choose your level to start</p>
      <div class="grade-grid">
        ${gradeButtons}
      </div>
      <a href="/" class="back-link">&larr; All Games</a>
    </div>`;
}

function renderQuiz() {
  const target = game.batch[game.questionIndex];
  const [word, emoji] = target;
  const progress = ((game.questionIndex + (game.answered ? 1 : 0)) / 10) * 100;

  let optionButtons = '';
  game.options.forEach(([w, e], idx) => {
    let cls = 'option-btn';
    if (game.answered && w === word) cls += ' correct';
    else if (game.selectedAnswer === idx && w !== word) cls += ' wrong';
    if (game.answered) cls += ' disabled';
    optionButtons += `<button class="${cls}" onclick="checkAnswer(${idx})">${w}</button>`;
  });

  let feedback = '';
  if (game.answered) {
    feedback = `<div class="feedback correct-fb">That's right! &mdash; <strong>${word}</strong> ${emoji}</div>`;
  } else if (game.selectedAnswer !== null) {
    feedback = `<div class="feedback wrong-fb">Not quite â€” try again</div>`;
  }

  return `
    <div class="quiz">
      <div class="quiz-header">
        <div class="score-display"><span class="pts">${game.score}</span> pts</div>
        <div class="progress-display">${game.questionIndex + 1} / 10</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${progress}%"></div>
      </div>
      <div class="emoji-area">
        <span class="emoji-big">${emoji}</span>
        <button class="speaker-btn" onclick="speakCurrentWord()" title="Hear the word">&#128266;</button>
      </div>
      <div class="options-grid">
        ${optionButtons}
      </div>
      ${feedback}
    </div>`;
}

function renderResults() {
  const pct = game.totalCorrectFirst / 10;
  let starCount = 1;
  if (pct >= 0.6) starCount = 2;
  if (pct >= 0.9) starCount = 3;

  let stars = '';
  for (let i = 0; i < 3; i++) {
    stars += `<span class="star-anim">${i < starCount ? 'â­' : 'â˜†'}</span>`;
  }

  let reviewCards = '';
  game.batch.forEach(([word, emoji], i) => {
    const ok = game.correctOnFirst[i];
    reviewCards += `
      <div class="review-card ${ok ? '' : 'missed'}">
        <span class="r-emoji">${emoji}</span>
        <span class="r-word">${word}</span>
        <span class="r-check">${ok ? 'âœ…' : 'ðŸ”„'}</span>
      </div>`;
  });

  return `
    <div class="results">
      <h2>All <span>Done!</span></h2>
      <div class="stars-area">${stars}</div>
      <div class="score-final">
        You scored <strong>${game.score}</strong> out of 100<br>
        ${game.totalCorrectFirst}/10 correct on first try
      </div>
      <div class="review-section">
        <h3>Your Words</h3>
        <div class="review-grid">${reviewCards}</div>
      </div>
      <div class="results-buttons">
        <button class="btn-replay" onclick="replayGrade()">Play Again</button>
        <button class="btn-home" onclick="goHome()">Choose Level</button>
      </div>
    </div>`;
}

// ===================== INIT =====================
render();
</script>
</body>
</html>